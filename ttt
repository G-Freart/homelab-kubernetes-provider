
        - name: Load balancer VRRP setup -- Configuring Firewalld
          block:

            - name: Load balancer setup -- Firewalld - Adding network interface to the internal zone
              firewalld:
                zone:              external
                interface:         "{{ clusters.definition[cluster_name].load_balancers.vrrp.external.iface }}"
                permanent:         true
                state:             enabled

            - name: Load balancer setup -- Firewalld - Allowing http service 
              firewalld:
                zone:             external
                state:            enabled
                permanent:        true
                service:          http
            
            - name: Load balancer setup -- Firewalld - Allowing https service 
              firewalld:
                zone:             external
                state:            enabled
                permanent:        true
                service:          https
            
            - name: Load balancer setup -- Firewalld - Allowing haproxy stat custom port service 
              firewalld:
                zone:             external
                state:            enabled
                permanent:        true
                port:             9000/tcp
            
            - name: Load balancer setup -- Firewalld - Allowing kubernetes apirest port service 
              firewalld:
                zone:             external
                state:            enabled
                permanent:        true
                port:             6443/tcp
            
            - name: Load balancer setup -- Relaunching Firewalld as zone has been created
              command:         systemctl restart firewalld
              become:          true
    

          become:   true
          when: 
            - clusters.definition[cluster_name].load_balancers.vrrp.external       is defined
            - clusters.definition[cluster_name].load_balancers.vrrp.external.iface is defined
            - cloud_images[clusters.definition[cluster_name].guest_os].application_firewall == 'firewalld'

        - name: Load balancer setup -- Configuring Ufw
          block:
            - name: Load balancer setup -- Activating ufw as allowing by default
              ufw:
                state:             enabled
                policy:            allow

            - name: Load balancer setup -- Ufw - Allowing http service
              ufw:
                rule:              allow
                port:              http
                proto:             tcp
                interface:         "{{ clusters.definition[cluster_name].load_balancers.vrrp.external.iface }}"
                direction:         in

            - name: Load balancer setup -- Ufw - Allowing https service
              ufw:
                rule:              allow
                port:              https
                proto:             tcp
                interface:         "{{ clusters.definition[cluster_name].load_balancers.vrrp.external.iface }}"
                direction:         in

            - name: Load balancer setup -- Ufw - Allowing haproxy stat custom port service 
              ufw:
                rule:              allow
                port:              '9000'
                proto:             tcp
                interface:         "{{ clusters.definition[cluster_name].load_balancers.vrrp.external.iface }}"
                direction:         in

            - name: Load balancer setup -- Ufw - Allowing kubernetes apirest incoming request
              ufw:
                rule:              allow
                port:              '6443'
                proto:             tcp
                interface:         "{{ clusters.definition[cluster_name].load_balancers.vrrp.external.iface }}"
                direction:         in
            
            - name: Load balancer setup -- Ufw - Allowing kubernetes apirest outgoing request
              ufw:
                rule:              allow
                port:              '6443'
                proto:             tcp
                interface:         "{{ clusters.definition[cluster_name].load_balancers.vrrp.external.iface }}"
                direction:         out
            
          become:   true
          when: 
            - clusters.definition[cluster_name].load_balancers.vrrp.external       is defined
            - clusters.definition[cluster_name].load_balancers.vrrp.external.iface is defined
            - cloud_images[clusters.definition[cluster_name].guest_os].application_firewall == 'ufw'


